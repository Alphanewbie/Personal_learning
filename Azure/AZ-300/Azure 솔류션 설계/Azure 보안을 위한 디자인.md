# Azure에서 멋진 솔루션 설계

## Azure의 보안을 위한 디자인

### 심층 방어

#### 제로 트러스트

신뢰를 가정하고 않고 지속적으로 신뢰를 검즘해야 한다.

사용자, 디바이스 및 데이터가 모두 조직의 방화벽 내에 있는 경우 신뢰할 수 있는 것으로 간주한다. 해커가 악의적으로 엔드포인트 디바이스를 손상시킨 이후 이렇게 가정된 신뢰는 쉬운 횡적 이동을 허용한다.

대부분의 사용자가 인터넷에서 애플리케이션 및 데이터에 액세스하고, 많은 회사에서 사용자가 BYOD(Bring-Your-Own-Devices)를 허용할 때 트랜잭션의 구성요소(사용자, 네트워크 및 디바이스) 대부분은 더 이상 조직의 제어를 받지 않습니다. 제로 트러스트 모델은 검증 가능한 사용자 및 디바이스의 신뢰 클레임을 사용하여 조직 리소스에 대한 액세스 권한을 부여합니다. 이제 위치가 조직 경계 내에 있다는 사실만으로 신뢰를 가정하지 않습니다.

이 모델로 인해 보안 연구원, 엔지니어 및 아키텍트는 **심층방어**라는 계층형 리소스 보호 보안 전락에 접근 방식을 다시 생각해 보게 되었습니다.

##### 심층방어

보안에 있어서 한가지의 방어 수준이 적절하지 않을 수도 있다.

데이터의 중요성에 따라 여러개 사용 사능

예를 들어 사용자가 WAF(웹 응용 프로그램 방화벽)을 사용하고 있고, 공격자가 이를 우회해서 공격하는 것을 막는것.

여기서 보낼 수 있는 악의적인 요청을 막으려면 사용자의 웹사이트는 입력 유효성 검사, 출력 인코딩 및 매개변수가 있는 쿼리 등 자체 방어를 갖춰야 한다.

이 개념의 또다른 구현이 바로 다단계 인증, 세가지 요소로 구성된다.

1. Knowledge factors
2. Ownership factors
3. Inherence factors

시스템에 인증하기 위해서는 두가지 요소가 필요 -> 공격자가 공격하기 2배로 어려워진다.

여기에는 

키 자격 증명 모음, 

인증서, 

연결 문자열, 

비밀 및 암호 넣기 

일반적으로 악성 IP 범위의 트래픽을 블랙홀링 차단하여 서비스 거부 공격을 감지하고 방어하는 추가된 네트워크 방어 계층인 DDOS보호 활성화, 

위험이 감지될 경우 즉시 정보를 받는 로깅, 감사 및 위협 보호 활성화, 

공격 표면을 줄기이 귀해 단기만 열어주는 요청한 경우를 제외하고는 모든 포트를 닫는 JIT(Just in time) 액세스 컨트롤 사용

응용 프로그램 코드에 대한 보안 테스팅 및 보안 코드 검토 수행, 

보안 디자인 및 보안 코딩에 관한 모범 사례를 따르고 항상 디자인에 대한 다른 사용자의 의견 묻기



#### 보안에 대한 계층화된 접근 방법

심층 방어는 정보에 무단으로 액세스 하려는 공격의 진행 속도를 늦추는 일련의 매커니즘을 사용하는 전략. 각 레이어가 보호를 제공하므로 한 레이어에서 침해 사고가 발생하더라도 후속 레이어가 이미 작동하기 때문에 추가 노출을 방지한다. 심층 방어의 목적은 액세스 권한이 없는 개인으로부터 정보를 보호하고 도난을 방지하는 것.

##### 보안의 3요소

- **기밀성** -  최소 권한의 원칙. 명시적으로 액세스 권한이 부여된 개인만 정보에 액세스 가능하도록 제한. 이 정보에는 사용자 암호, 원격 액세스 인증서 및 이메일 콘텐츠에 대한 보호 포함
- **무결성** - 미사용 및 전송 중인 정보의 무단 변경 방지, 데이터 전송에 사용되는 일반적인 방법은 발신자가 반향향 해시 알고리즘을 사용하여 고유한 데이터 지문을 만드는 것. 해시는 데이터와 함께 수신자에게 전송된다. 수신자는 데이터의 해시를 다시 계산해서 원본과 비교하여 데이터가 전송 도중에 손실 또는 수정 되지 않았는지 확인한다.
- **가용성** - 인증된 사용자가 서비스를 이용할 수 있어야한다. 서비스 거부 공격으로 인해 사용자에게 가용성 손실이 자주 발생한다. 또한 자연재해를 고려하여 단일 실패 지점을 방지하고 여러 애플리케이셩 인스턴스를 지리적으로 분산된 위치에 배포하도록 시스템을 설계해야 한다.

#### 보안 계층

데이터 보안을 시작화 했을 때의 레이어

![센터에 있는 데이터를 사용한 심층 방어를 보여주는 일러스트레이션 데이터와 관련된 보안은 애플리케이션, 컴퓨팅, 네트워크, 경계, ID와 액세스 및 물리적 보안을 포함합니다.](https://docs.microsoft.com/ko-kr/learn/modules/design-for-security-in-azure/media/defense_in_depth_layers_small.png)

##### 데이터

공격자의 목표가 데이터

- 데이터베이스에 저장된 데이터
- 가상 머신 내부의 디스크에 저장된 데이터
- Office 365와 같은 SaaS애플리케이션에 저장된 데이터
- 클라우드 스토리지에 저장된 데이터

데이터를 저장하고 액세스를 제어하는 사용자는 데이터를 적절하게 보호할 책임이 있다.

##### 애플리케이션

- 안전하고 취약점이 없도록 애플리케이션 보호
- 중요한 애플리케이션 비밀을 안전한 스토리지 매체에 저장
- 모든 애플리케이션 개발 시 보안을 요구 사항으로 지정

애플리케이션 개발 수명 주기에 보안을 통합하면 코드에서 발생하는 취약점을 줄일 수 있다. 모든 개발 팀이 기본적으로 애플리케이션을 안전하게 만들도록 합니다. 보안 요구사항을 협상하지 않도록 한다.

##### 컴퓨팅

- 가상머신 액세스 보안
- 엔드 포인트 보호를 구현하고 지속적으로 시스템 패치 및 최신 상태 유지

멀웨어, 패치가 적용되지 않는 시스템, 적절하게 보호되지 않는 시스템 때문에 환경이 공격에 노출된다. 이 레이어의 핵심을 컴퓨팅 리소스를 안전하게 보호하고 보안 문제를 최소화하는 적절한 제어가 마련

##### 네트워킹

- 엑세스 구분 및 제어를 통해 리소스 간의 통신 제한
- 기본적으로 거부
- 언바운드 인터넷 엑세스를 금지하고 필요한 경우 아웃바운드를 제한
- 온-프레미스 네트워크에 대한 보안 연결을 구현

이 계층의 핵심은 필요한 리소스에만 액세스 할 수 있도록 모든 리소스에서 네트워크 연결을 제한하는 것입니다. 리소스를 분할하고 네트워크 수준 제어를 사용하여 필요한 경우에만 통신을 제한합니다. 이 통신을 제한하여 네트워크 전체에서 횡적 이동의 위험을 줄인다

##### 경계

- DDOS 보호 기능을 사용하여 최종 사용자에게 서비스 거부가 발생하기 전에 대규모 공격을 필터링
- 경계 방화벽을 사용하여 네트워크에 대한 악의적인 공격을 파악하고 그에 대해 경고

네트워크 경계에서, 리소스에 대한 네트워크 기반 공격을 방어한다. 네트워크 보안을 위자하려면 이러한 공격을 파악하여 영향을 제거하고 공격에 대해 경고하는 것이 중요.

##### ID 및 액세스

- 인프라에 대한 액세스 제어, 변경 제어
- Single Sign-On 및 다단계 인증 사용
- 이벤트 및 변경 내용 감사

ID 및 액세스 레이어는 ID를 안전하게 보호하고, 필요한 때에만 액세스 권한을 부여하고 변경 내용을 기록한다.

##### 물리적 보안

- 물리적 빌드 보안 및 데이터 센터 내의 컴퓨팅 하드웨어에 대한 액세스 제어가 첫 번째 방어선 입니다.

물리적 보안을 사용하는 목적은 자산 액세스에 대한 물리적 보호수단을 제공하는 것. 이렇게 하면 다른 레이어가 무시되지 않는지 및 손실 또는 도난이 적절하게 처리되는지 확인할 수 있다.

각 레이어는 CIA 중 하나를 구현할 수 있다.

| #    | 원           | 예                                           | 원칙   |
| :--- | :----------- | :------------------------------------------- | :----- |
| 1    | 데이터       | Azure Blob 스토리지의 미사용 데이터 암호화   | 무결성 |
| 2    | 애플리케이션 | SSL/TLS 암호화 세션                          | 무결성 |
| 3    | 컴퓨팅       | 정기적으로 OS 및 계층화 소프트웨어 패치 적용 | 가용성 |
| 4    | 네트워크     | 네트워크 보안 규칙                           | 기밀성 |
| 5    | 경계         | DDoS 보호                                    | 가용성 |
| 6    | ID 및 액세스 | Azure Active Directory 사용자 인증           | 무결성 |
| 7    | 물리적 보안  | Azure 데이터 센터 생체 인식 액세스 제어      | 기밀성 |

#### 문제

1. *심층 방어*는 사용자 정보에 액세스 권한을 얻으려는 공격으로부터 보호하기 위한 전략인가요?

   *심층 방어*는 권한이 없는 액세스로부터 보호를 제공하는 계층화된 시스템입니다. 한 계층을 위반하는 경우 추가로 노출되지 않도록 하기 위해 다른 계층이 마련됩니다.