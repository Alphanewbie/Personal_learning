# Azure 아키텍쳐

## Azure 아키텍쳐 핵심요소

### Azure 아키텍쳐 설계
 
1. 보안
2. 성능 및 확장성
3. 가용성 및 복구 가능
4. 효율성 및 운영

#### 보안

- 인증
  - 아키텍쳐에 대한 액세스 보호, 
  - 네트워크 취약성으로부터 애플리케이션 및 데이터 보호하는데 집중
  - 암호화 도구를 사용하여 데이터 무결성 보호
- 디자인 및 구현에서부터 배포 및 작업까지 애플리케이션 전체 생명 주기 동안 보안을 고려.
  - 노출된 자격 증명
  - 네트워크 공격
  - 멀웨어
  - 피싱
  - 앱 취약성

#### 성능 및 확장성

- 리소스 용량과 수요를 적절히 일치시켜야한다.
- 클라우드  아키텍처는 애플리케이션 작업을 기반으로 애플리케이션 크기를 동적으로 조정하여 일치시킨다.
- 서비스 변경에 대한 요구가 있으므로 아키텍처는 요구에 맞게 조정할 수 있는 역량이 있어야한다.
- 설계부터 성능 및 확장성을 염구에 둔다. 고객에게 효율적이면서 뛰어난 환경 제공

![수요에 따라 클라우드의 리소스 규모를 동적으로 조정하여 효율성을 높이는 방법을 보여주는 일러스트레이션. 반면, 고정된 수준에서 리소스를 구현하면 수요가 적을 때에는 효율성이 떨어지고 수요가 많을 때에는 리소스가 부족하게 됩니다.](https://docs.microsoft.com/ko-kr/learn/modules/pillars-of-a-great-azure-architecture/media/performance-demand.png)



#### 가용성 및 복구 기능

- 아키텍쳐가 복구 방법 없이 중단 되는 것을 막는다.
- 성공적인클라우드 환경은 모든 수준의 오류를 예측할 수 있는 방식으로 설계된다.
- 이러한 오류 예측의 일부는 관련자와 고객이 요구하는 시간 내에 오류를 복구할 수 있는 시스템을 설계



#### 효율성 및 운영

- 비용 효율적으로 작동하고 개발하도록 클라우드  환경 설계

  - 클라우드 지출에서 비효율성 및 낭비 식별

  - 오류의 문제가 발생하기 전에 or 고객이 확인하기 전에 오류 및 문제 감지

    ​	-> 모니터링 아키텍쳐 필요

  - 모니터링 프레임워크를 통해 해당 사용 사능한 리소르를 사용하는 방법에 대한 몇가지 표시 유형이 있어야 한다.



#### 공동책임

- 공동 책임 모델이 도립.
  - 클라우드 공급자는 애플리케이션의 특정 측면을 관리하고 나머지 책임은 사용자에게 맡긴다.
    1. 온-프레미스 : 모든 항목을 사용자가 관리
    2. IasS, PaaS, SaaS 로 갈수록 사용자가 더 적은 책임을 가진다.
  -  애플리케이션의 비용, 운영기능, 보안 기술적 기능에 영향을 준다.
    - 장점 
      - 공급자는 비즈니스 가치 부여에 집중할 수 있다.

#### 설계선택

- 가장 안정적이고 높은 성능 및 고가용성의 효율적인 환경 빌드
  - 단점
    - 핵심 요소를 높은 수준으로 빌드하려면 비용이 발생.
    - 해당 비용은 실제 금액, 배달시간 또는 운영에 민첩성에 해당할 수 있다.
    - 조직마다 설계 영향이 다르기 때문에, 허용 불가능한 단점 고려
- Azure 아키텍쳐를 빌드할 때는 많은 고려사항 염두에 두어야 한다.
  - 안전, 확장기능, 사용가능, 복구 가능



### 보안을 위한 디자인

#### 무엇을 보호해야 하나

- 데이터
  - 고객의 데이터
  - 조직에 대한 재무 정보
  - 조직을 지원하는 업무 데이터
- 인프라의 보안
- 데이터 엑세스 ID



- 특히 데이터는 법률에 대한 규정 요구의 적용을 받을 수 있다.



#### 심층 방어

사용자 환경 보호를 위해 다단계 접근 방식을 사용. -> 심층방어

- 심층 방어 계층
  - 데이터
  - 어플리케이션
  - VM/컴퓨팅
  - 네트워킹
  - 경계
  - 정책 및 액세스
  - 물리적 보안



한 계층이 뚫리는 경우 각 겨층은 공격이 발생할 수 있는 다른 영역에 중점을 준다.

한 계층에만 집중하는 경우 공격자가 뚫게 되면 사용자 정보에 액세스하게 되므로 각 계층에 집중하다

각 계층마다 적용할 보안 제어, 기술 및 기능이 있다.

![센터에 있는 데이터를 사용한 심층 방어를 보여주는 일러스트레이션. 데이터 주변의 보안 링에는 애플리케이션, 컴퓨팅, 네트워크, 경계, ID 및 액세스, 물리적 보안이 포함됩니다.](https://docs.microsoft.com/ko-kr/learn/modules/pillars-of-a-great-azure-architecture/media/security-layers.png)



#### 일반적인 공격

각 계층마다 공격 병식

- **데이터 레이어** : 암호화 키가 노출 되거나 약한 암호화를 사용할 경우 무단 엑세스 발생시 데이터 공격에 취약해진다



- **어플리케이션 레이어** : 악성 코드 삽입 및 실행이 애플리케이션 레이어 공격의 특징. 일반적인 공격에는 SQL삽입 및 사이트간 스크립팅(XSS) 포함

  [^XSS]: 사용자가 공격하려는 사이트에 스크립트를 넣는 기법을 말한다.

  

- **VM/컴퓨팅 레이어** : 맬웨어는 황경을 공격하는 일반적인 방법, 시스템을 손상시키는 악성 코드 실행을 포함한다. 맬웨어가 시스템에 존재하면, 자격 증명 노출 및 환경 전체에 걸친 수평 이동으로 이어지는 추가 공격 발생 가능



- **네트워킹 레이어** : 인터넷에 대해 불필요하게 개방된 포트는 일반적인 공격 매서드. 이런 포트에는 가상머신에 대해 개방된 SSH또는 RDP가 포함될 수 있다.

  [^SSH]: 네트워크 상의 다른 컴퓨터에 로그인하거나 원격 시스템에서 명령을 싷랳
  [^RDP]: 다른 PC에 그래픽 사용자 인터페이스를 제공 ex)팀뷰어

  

- **경계 레이어** : 서비스 거부 공격(DOS) 당하는 계층. 네트워크 리소스를 강제로 오프라인으로 전환하거나 합법적인 요청에 응할 수 없게 만들어 네트워크 리소스에 과부하가 걸리게 한다.



- **정책 및 액세스 레이어** : 이 레이어 애플리케이션에 대한 인증이 발생하는 위치. 이 레이어에는 OpenID Connect, OAuth 또는 Active Directory 같은 Keroberos 기반 인증 등의 최신 인증 프로토콜이 포함 될 수 있다. 이 계층에서의 노출된 자격 증명은 위험 ->  ID사용 권한을 제한. 또한 비정상적인 위치에서 들어오는 로그인 등 손상 가능한 계정을 검색하도록 모니터링 마련

  [^OAuth]: 인터넷 사용자들이 비밀번호를 제공하지 않고 다른 웹 사이트상의 자신들의 정보에 대한 접근 권한을 부여받는 수단
  [^OpenID Connect]: OAuth의 확장 버전,  인증에 대한 정보는 ID Token 이라고 불리는 JSON Web Token을 리턴해 준다.
  [^Active Directory]: 네트워크 개체에 대한 정보를 저장하는 계층 구조,  사용자의 계정에 대한 정보를 암호회 해서 다른 곳에서 사용가능하게 하는 것. 예를 들면 사용자 계정 공유 같은 것

  

- **물리적 레이어** : 도어 드래프팅 및 보안 배지 도용같은 매서드를 통해 시설에 대한 무단 액세스 볼 수 있다.



#### 공동 보안 책임

선택한 서비스 유형에 따라 제공되는 보안

![클라우드 공급자 및 고객이 온-프레미스, IaaS(infrastructure as a service), PaaS(platform as a service) 및 SaaS(software as a service) 같은 다양한 형식의 컴퓨팅 서비스 구현에서 보안 책임을 공유하는 방법을 보여주는 일러스트레이션. ](https://docs.microsoft.com/ko-kr/learn/modules/pillars-of-a-great-azure-architecture/media/shared_responsibilities.png)





#### 지식 검사

다음 중 정책 및 액세스 계층에 표시될 수 있는 공격의 예제는 무엇인가요?

1. 자격 증명을 입력하지 않고 직원을 따라 데이터 센터로 침입
   - 직원을 따라 데이터 센터로 침입하는 것은 물리적 계층 공격
2. SYN 도배 공격
   -  네트워크 경계에서 확인되는 서비스 거부 공격(DOS) 형식



### 성능 및 확장성을 위한 디자인

#### 크기 조정 및 성능 최적화란?

애플리케이션이 수신하는 요구와 애플리케이션에 사용할 수 있는 리소스를 일치시키는 방법에 대한 것.

성능 최적화에는 리소스 크기 조정, 병목상태 구분 및 최적화, 최고 성능에 대한 애플리케이션 코드 최적화 포함

##### 크기 조정

리소스 컴퓨팅 크기 조절 방법 2가지

1. 강화 : 단일 인스턴스에 더 많은 리소스를 추가하는 동작
   - 이 인스턴스는 가상 머신 또는 PasS 서비스일 수도 있다. 어플리케이션 리소ㅛ스를 증가시키지만, 
   - 추가는 제한적. 가상 머신을 실행하는 호스트의 용량으로 제한. 
   - 자체 호스트에는 물리적 제한이 있다. 결과적으로는 리소스 추가를 제한하는 결과로 나타난다.
2. 확장 : 인스턴스를 추가하는 방식
   - 이 인스턴스는 가상 머신 또는 PasS 서비스일 수도 있다. 단일 인스턴스를 강화하는 대신에 총 인스턴스 수를 늘려서 용량을 추가. 
   - 확장에 제한이 없다. 확장에는 특정 유형의 부하 분산이 필요하다. 
   - 부하 분산은 사용가능한 서버에 요청을 분산하는 부하 분산 장치 또는 요청을 보내는 활성 서버를 구분하기 위한 서비스 검색 매커니즘의 현태로 제공된다.

##### 성능 최적화

성능 이 허용가능한지 확인하기 위해 네트워크 및 스토리지 확인. 둘 다 어플리케이션 응답시간에 영향을 줄 수 있다. 아키텍쳐에 대한 올바른 네트워킹 및 스토리지 기술을 선택하면 소비자에게 최상의 환경 제공하는데 도움

성능 최적화에는 또한 애플리케이션 자체가 작동하는 방법을 이해. 잘못된 코드 및 종속 시스템은 병목 형상 발생은 성능 관리 도구를 통해 파악 가능. 이런 경우의 문제는 최종 사용자, 개발자 및 관리자에게 숨기거나 난독 처리 될 수 있지만, 애플리케이션의 전반적인 성능에 부정적인 영향을 미친 수 있다.

#### 확장성과 성능 패턴 및 사례

성능과 확장성을 향상 시키기 위해 활용할 수 있는 패턴

##### 데이터 분할

대규모 솔류션은 데이터를 개별적으로 관리하고 액세스 할 수 있는 별도의 파티션으로 나눈다. 분할 전략은 부정적인 영향을 최소하하고 이즘금 극대화 할 수 있도록 선택. 분할을 통해 확장성을 향상시키고 경합을 줄여 성능을 최적화 할 수 있다.

##### 캐싱

아키텍쳐에서 캐싱을 사용하여 성능을 향상. 캐싱은 빠른 검색을 위해 자주 사용되는 데이터 또ㅛ는 자산을 저장하는 매커니즘. 캐싱은 애플리케이션의 다른 계층에 사용될 수 있다. 애플리케이션 서버 및 데이터베이스 간에 캐싱을 사용하여 검색 시간을 줄인다. 또한 사용자 및 웹 서버 사이에 캐싱을 사용하요 고정 컨텐츠를 사용자에게 가깝게 배치하고 사용자에게 반환하는 시간을 줄인다. 이 캐싱을 요청을 오프로딩하는 부차적인 영향을 무쳐 성능을 향상시킨다.

##### 자동 크기 조정

성는 요구 사항에 맞게 리소스를 동적으로 할당. 작업 용량이 증가하면 애플리케이션에는 원하는 성능 수준을 유지하고 SLA를 만족하기 위해서 추가 리소스가 필요할 수 있습니다. 수요가 감소하고, 추가 리소스가 필요 없어지면 비용을 최소하화기위해 할당을 취소할 수 있다.

자동 크기 조정은 관리 부담을 완화하면서 클라우드에 호스트된 환경의 탄력성을 활욯합니다. 이렇게 하면 운영자가 시스템을 지속적으로 모니터링하고 리소스 추가 제거를 결정할 필요가 줄어든다.

##### 리소스 집약적인 작업을 백그라운드 작업으로 분리

UI(사용자 인터페이스)와 독립적으로 실행되는 백그라운드 작업이 필요. 예로는 배치작업, 집약적인 처리작업, 워크플로 등의 장기 실행 프로세스가 있다. 백그라운드 작업은 사용자 조작없이 실행할 수 있으며, 애플리케이션은 작업을 시작한 다음 사용자의 조작요청을 계속 처리 가능. 따라서 UI에 대한 부담을 최소화 함으로서 가용성을 개선하고 대화형 응답 시간을 줄일 수 있다.

##### 서비스 간 메시징 계층 사용

성능 및 확장성에 이점이 될 수 있다. 메시징 계층을 추가하면 서비스간 요청에 대한 버퍼를 만드므로 애플리케이션이 유지될 수 없는 경우에도 요청은 오류없이 계속 유입 될 수 있다. 수신된 순서에 따라 요청에 응답 할 수 있다.

##### 배율 단위 구현

단위로 크기를 조정한다. 각 리소스에서 종속 시스템에 크기 조정작업이 일으킬 수 있는 영향을 확인. 그렇게 확장 작업을 적용하고, 애플리케이션에 부정적인 영향을 줄일 수 있다. 예를 들어 x개의 웹 및 작업자 역할을 추가하려면 역할에서 생성되는 추가 워크로드를 처리하기 위해 y개의 추가 쿼리 및 z개의 스토리지 계정이 필요할 수 있습니다. 배율 단위는 x개의 웹 및 작업자 역할, y개의 큐 및 z개의 스토리지 계정으로 구성됩니다. 하나 이상의 배율 단위를 추가하여 쉽게 확장할 수 있도록 애플리케이션을 디자인합니다.

##### 성능 모니터링

클라우드에서 실행되는 분산 애플리케이션 및 서비스는 특성상 많은 이동 부분으로 구성되는 복잡한 소스트웨어. 프로덕션 환경에서는 사여ㅛㅇ자가 시스템을 활용하는 방식과 리소스 사용률을 추적하고, 시스템의 상태 및 성능을 전반적으로 모니터링 할 수 있어야한다. 이 정보를 진단 보조 기능으로 사용하여 문제를 검색하고 수정할 수 잇으며 잠재적인 문제를 발견하여 문제가 발생하지 않도록 할 수도 있다.

모든 계층을 살쳐보고 병목 상태를 파악하고 수정, 병목 상태는 인덱스를 추가하는 과정에서 메모리가 잘못 처리 될 수가 있다. 하나의 병목을 해결하면 다른 병목이 생길 수도 있으니 주의